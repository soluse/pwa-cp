<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>쿠팡 바로가기 설치 안내</title>
  <link rel="manifest" href="/pwa-cp/manifest.json">
  <meta name="theme-color" content="#0078FF">
  <meta name="description" content="쿠팡 사이트 바로가기를 홈 화면에 추가하는 공식 안내 페이지입니다.">
  <style>
    :root { --brand:#0078FF; --text:#222; --muted:#586174; --bg:#f7f8fa; --shadow:rgba(0,0,0,.08); }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); min-height:100dvh; display:grid; place-items:center;
           font-family: 'Noto Sans KR', system-ui, -apple-system, Helvetica, Arial, sans-serif; color:var(--text); }
    .card { width:min(92vw,420px); background:#fff; border-radius:20px; padding:40px 26px; text-align:center;
            box-shadow:0 16px 40px var(--shadow); }
    .logo { width:140px; height:auto; margin:0 auto 18px; display:block; }
    h1 { font-size:1.35rem; margin:0; }
    p { margin:12px 0 0; color:#555; line-height:1.6; }
    .footer { margin-top:16px; font-size:.85rem; color:#888; }
    /* Install banner */
    .install-banner { position:fixed; inset:auto 0 0 0; background:#fff; border-top:1px solid #e9edf3;
      padding:14px 16px; box-shadow:0 -6px 24px rgba(0,0,0,.08); z-index:9999; display:none; }
    .install-banner.show { display:block; }
    .install-row { display:flex; align-items:center; gap:12px; max-width:720px; margin:0 auto; }
    .install-title { font-weight:700; color:#222; }
    .install-desc { color:#586174; font-size:.92rem; }
    .install-actions { margin-left:auto; display:flex; gap:8px; }
    .btn { border:0; border-radius:10px; padding:10px 14px; cursor:pointer; font-size:.95rem; }
    .btn-primary { background:#0078FF; color:#fff; }
    .btn-ghost { background:#f3f6ff; color:#214a88; }
  </style>
</head>
<body>
  <main class="card" role="main" aria-label="쿠팡 바로가기 안내">
    <img class="logo" src="https://static.coupangcdn.com/image/coupang/common/logo_coupang_w350.png" alt="쿠팡 로고">
    <h1>쿠팡 바로가기를 홈 화면에 추가하세요</h1>
    <p>설치 후 아이콘을 열면 즉시 <b>쿠팡</b>으로 이동합니다.</p>
    <div class="footer">© Coupang · 안내 페이지</div>
  </main>

  <!-- 설치 배너 (자동 표시) -->
  <div id="installBanner" class="install-banner" role="dialog" aria-label="홈 화면에 추가">
    <div class="install-row">
      <div>
        <div class="install-title">쿠팡 바로가기를 홈 화면에 설치</div>
        <div class="install-desc">아이콘을 추가하면 앱처럼 바로 접속할 수 있어요.</div>
      </div>
      <div class="install-actions">
        <button id="installBtn" class="btn btn-primary">설치</button>
        <button id="closeInstall" class="btn btn-ghost">나중에</button>
      </div>
    </div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/pwa-cp/service-worker.js')
        .then(r => console.log('SW registered:', r.scope))
        .catch(e => console.error('SW registration failed:', e));
    }

    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
    const banner = document.getElementById('installBanner');
    const btnInstall = document.getElementById('installBtn');
    const btnClose = document.getElementById('closeInstall');

    let deferredPrompt = null;

    function showIOSGuide() {
      banner.querySelector('.install-title').textContent = '홈 화면에 추가 (iPhone)';
      banner.querySelector('.install-desc').innerHTML = 'Safari 하단 <b>공유(⬆️)</b> ▶ <b>홈 화면에 추가</b>를 눌러 설치하세요.';
      btnInstall.style.display = 'none';
      banner.classList.add('show');
    }

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (!isStandalone && !isIOS) {
        btnInstall.disabled = false;
        btnInstall.textContent = '설치';
        banner.classList.add('show');
      }
    });

    window.addEventListener('load', () => {
      if (isStandalone) return;
      if (isIOS) {
        showIOSGuide();
      } else {
        btnInstall.disabled = true;
        btnInstall.textContent = '설치 준비 중…';
        banner.classList.add('show');
      }
    });

    btnClose.addEventListener('click', () => banner.classList.remove('show'));

    btnInstall.addEventListener('click', async () => {
      if (!deferredPrompt) {
        alert('잠시 후 다시 시도해 주세요. 설치 준비가 되면 버튼이 활성화됩니다.');
        return;
      }
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      deferredPrompt = null;
      banner.classList.remove('show');
      if (outcome === 'accepted') {
        console.log('PWA install accepted');
      }
    });

    window.addEventListener('appinstalled', () => {
      console.log('App installed');
      // location.href = 'https://www.coupang.com/?utm_source=appinstalled';
    });
  </script>
</body>
</html>
